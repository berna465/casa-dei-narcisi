<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Casa dei Narcisi — Loft a Milano (Paolo Sarpi)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Casa dei Narcisi: loft moderno a Milano in zona Paolo Sarpi. Prenotazione diretta dal sito ufficiale.">

  <style>
    :root{
      --bg:#0f1220;
      --card:#161a2b;
      --txt:#ffffff;
      --muted:#aeb6c7;
      --line:#2a2f45;
      --acc:#4fd1c5;
      --acc2:#7dd3fc;
      --shadow: 0 8px 20px rgba(0,0,0,.25);
      --r:14px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:var(--bg);
      color:var(--txt);
      padding-bottom:72px; /* spazio per footer sticky */
    }

    a{ color:inherit; }
    .wrap{ max-width:1100px; margin:auto; padding:30px; }

    .card{
      background:var(--card);
      border-radius:var(--r);
      padding:22px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.04);
    }

    .muted{ color:var(--muted); }
    h1{ font-size:40px; margin:0 0 10px; line-height:1.05; }
    h2{ margin:0 0 10px; font-size:20px; }
    h3{ margin:0 0 10px; font-size:16px; }
    p{ margin:0 0 12px; }

    /* Top nav */
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .brand{ font-weight:800; letter-spacing:.2px; display:flex; gap:10px; align-items:center; }
    .navlinks{ display:flex; gap:14px; flex-wrap:wrap; align-items:center; }

    .navlinks a{
      text-decoration:none;
      color:var(--muted);
      font-weight:650;
      padding:6px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.06);
      background:rgba(255,255,255,.02);
    }
    .navlinks a:hover{ color:var(--txt); border-color:rgba(255,255,255,.12); }

    .langpick{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.06);
      background:rgba(255,255,255,.02);
      color:var(--muted);
      font-weight:700;
    }
    .langpick select{
      appearance:none;
      border:0;
      outline:none;
      background:transparent;
      color:var(--txt);
      font-weight:800;
      cursor:pointer;
    }
    .langpick option{ color:#111; }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:18px;
      align-items:stretch;
      margin-bottom:18px;
    }
    .hero img{ width:100%; border-radius:12px; display:block; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 16px;
      border-radius:12px;
      text-decoration:none;
      font-weight:800;
      border:1px solid rgba(255,255,255,.06);
      cursor:pointer;
    }
    .btn.primary{ background:var(--acc); color:#041014; border-color:transparent; }
    .btn.ghost{ background:transparent; color:var(--txt); border-color:rgba(255,255,255,.14); }
    .btn.primary:hover{ filter:brightness(1.05); }
    .btn.ghost:hover{ border-color:rgba(255,255,255,.22); }

    /* Main layout: left content, right booking */
    .main{
      display:grid;
      grid-template-columns: 1.08fr 0.92fr;
      gap:18px;
      align-items:start;
    }
    .sticky{
      position:sticky;
      top:16px;
    }

    /* Sections spacing */
    .section{ margin-bottom:18px; }
    .section:last-child{ margin-bottom:0; }

    /* Services list */
    ul{ margin:10px 0 0 18px; padding:0; }
    li{ margin:8px 0; }
    strong{ color:var(--txt); }

    /* Gallery */
    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      margin-top:10px;
    }
    .thumb{
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.06);
      background:#0b0e1a;
      cursor:pointer;
      position:relative;
    }
    .thumb img{
      width:100%;
      height:190px;
      object-fit:cover;
      display:block;
      transform:scale(1.001);
      transition:transform .15s ease;
    }
    .thumb:hover img{ transform:scale(1.03); }
    .thumb:focus-visible{ outline:2px solid var(--acc2); outline-offset:2px; }

    /* Host section */
    .host-section{
      padding:22px;
      border-radius:var(--r);
      background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow);
    }
    .host-section .accent{
      display:inline-block;
      width:42px;
      height:3px;
      background:#cfa85a;
      border-radius:99px;
      margin:8px 0 12px;
      opacity:.9;
    }

    /* Booking wrapper */
    .booking-shell{
      padding:18px;
      border-radius:var(--r);
      background:var(--card);
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.04);
    }

    /* Contact form */
    .form{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .row2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    input, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0b0e1a;
      color:var(--txt);
      outline:none;
    }
    textarea{ min-height:130px; resize:vertical; }
    input::placeholder, textarea::placeholder{ color:var(--muted); }
    .hint{ font-size:12px; color:var(--muted); }
    .ok{ color:#b7f7d2; font-weight:800; }
    .err{ color:#ffb4b4; font-weight:800; }

    /* Lightbox */
    .lb{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.82);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .lb.open{ display:flex; }
    .lb-inner{
      width:min(980px, 100%);
      background:#0b0e1a;
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      box-shadow:0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .lb-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:var(--muted);
      gap:10px;
    }
    .lb-top .title{ font-size:13px; }
    .lb-actions{ display:flex; gap:8px; }
    .iconbtn{
      background:transparent;
      border:1px solid rgba(255,255,255,.12);
      color:var(--txt);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:800;
    }
    .iconbtn:hover{ border-color:rgba(255,255,255,.22); }
    .lb-img{
      width:100%;
      height:min(72vh, 760px);
      display:flex;
      align-items:center;
      justify-content:center;
      background:#000;
    }
    .lb-img img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      display:block;
    }
    .lb-nav{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .lb-prev, .lb-next{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      pointer-events:auto;
    }
    .lb-prev{ left:10px; }
    .lb-next{ right:10px; }

    /* Sticky footer bar */
    .footerbar{
      position:fixed;
      left:0; right:0; bottom:0;
      background:rgba(11,14,26,.92);
      backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,.08);
      z-index:9998;
    }
    .footerbar .inner{
      max-width:1100px;
      margin:auto;
      padding:10px 14px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .footerbar .mini{
      color:var(--muted);
      font-size:13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Responsive */
    @media(max-width: 980px){
      .hero{ grid-template-columns:1fr; }
      .main{ grid-template-columns:1fr; }
      .sticky{ position:static; }
      h1{ font-size:32px; }
      .grid{ grid-template-columns:1fr 1fr; }
      .row2{ grid-template-columns:1fr; }
    }
    @media(max-width: 560px){
      .grid{ grid-template-columns:1fr; }
      .nav{ flex-direction:column; align-items:flex-start; }
      .navlinks{ width:100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="nav">
      <div class="brand">
        <span>Casa dei Narcisi</span>

        <div class="langpick" title="Language">
          <span data-i18n="lang.label">Lingua</span>
          <select id="langSelect" aria-label="Language selector">
            <option value="it">IT</option>
            <option value="en">EN</option>
            <option value="fr">FR</option>
            <option value="de">DE</option>
            <option value="es">ES</option>
          </select>
        </div>
      </div>

      <div class="navlinks">
        <a href="#servizi" data-i18n="nav.services">Servizi</a>
        <a href="#foto" data-i18n="nav.photos">Foto</a>
        <a href="#posizione" data-i18n="nav.location">Posizione</a>
        <a href="#contatti" data-i18n="nav.contact">Contatti</a>
        <a href="#prenota" data-i18n="nav.book">Prenota</a>
      </div>
    </div>

    <div class="hero">
      <div class="card">
        <h1>
          <span data-i18n="hero.title">Loft moderno a Milano</span><br>
          <span class="muted" data-i18n="hero.subtitle">zona Paolo Sarpi</span>
        </h1>

        <p class="muted" data-i18n="hero.lead">
          Un rifugio curato e funzionale in Chinatown: perfetto per soggiorni business o leisure, e comodissimo per eventi in città.
        </p>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <a class="btn primary" href="#prenota" data-i18n="cta.availability">Verifica disponibilità</a>
          <a class="btn ghost" href="#contatti" data-i18n="cta.contact">Scrivici</a>
        </div>

        <p class="muted" style="margin-top:10px; font-size:13px;" data-i18n="hero.note">
          Prenotazione diretta dal sito ufficiale.
        </p>
      </div>

      <div class="card">
        <img src="images/hero.jpg" alt="Casa dei Narcisi — Milano">
      </div>
    </div>

    <div class="main">
      <!-- LEFT COLUMN -->
      <div>
        <div class="card section" id="servizi">
          <h2 data-i18n="services.title">Servizi</h2>
          <p class="muted" data-i18n="services.lead">Essenziale, pulito, comodo. Tutto quello che serve per vivere Milano bene.</p>

          <ul class="muted">
            <li><strong data-i18n="services.wifiStrong">Wi-Fi</strong> <span data-i18n="services.wifi">veloce</span></li>
            <li><strong data-i18n="services.kitchenStrong">Cucina</strong> <span data-i18n="services.kitchen">attrezzata</span></li>
            <li><strong data-i18n="services.linenStrong">Biancheria</strong> <span data-i18n="services.linen">e asciugamani inclusi</span></li>
            <li><strong data-i18n="services.selfcheckStrong">Self check-in</strong> <span data-i18n="services.selfcheck">(quando disponibile)</span></li>
            <li><strong data-i18n="services.areaStrong">Zona servita</strong>: <span data-i18n="services.area">ristoranti, market e servizi in Paolo Sarpi</span></li>
            <li><strong data-i18n="services.eventsStrong">Ideale per eventi</strong> <span data-i18n="services.events">e soggiorni business/leisure</span></li>
          </ul>

          <h3 style="margin-top:18px;" data-i18n="rules.title">Regole essenziali</h3>
          <ul class="muted">
            <li data-i18n="rules.noParties">Niente feste / eventi</li>
            <li data-i18n="rules.neighbors">Rispetto del vicinato</li>
            <li data-i18n="rules.capacity">Orari e capienza come da prenotazione</li>
          </ul>
        </div>

        <div class="card section" id="foto">
          <h2 data-i18n="photos.title">Foto</h2>
          <p class="muted" data-i18n="photos.lead">Clicca su una foto per ingrandire e navigare.</p>

          <div class="grid" id="gallery">
            <div class="thumb" tabindex="0" data-full="images/foto1.jpg" data-alt="Foto 1"><img src="images/foto1.jpg" alt="Foto 1"></div>
            <div class="thumb" tabindex="0" data-full="images/foto2.jpg" data-alt="Foto 2"><img src="images/foto2.jpg" alt="Foto 2"></div>
            <div class="thumb" tabindex="0" data-full="images/foto3.jpg" data-alt="Foto 3"><img src="images/foto3.jpg" alt="Foto 3"></div>
            <div class="thumb" tabindex="0" data-full="images/foto4.jpg" data-alt="Foto 4"><img src="images/foto4.jpg" alt="Foto 4"></div>
            <div class="thumb" tabindex="0" data-full="images/foto5.jpg" data-alt="Foto 5"><img src="images/foto5.jpg" alt="Foto 5"></div>
            <div class="thumb" tabindex="0" data-full="images/foto6.jpg" data-alt="Foto 6"><img src="images/foto6.jpg" alt="Foto 6"></div>
			<div class="thumb" tabindex="0" data-full="images/foto6.jpg" data-alt="Foto 7"><img src="images/foto7.jpg" alt="Foto 7"></div>
			<div class="thumb" tabindex="0" data-full="images/foto6.jpg" data-alt="Foto 8"><img src="images/foto8.jpg" alt="Foto 8"></div>
			<div class="thumb" tabindex="0" data-full="images/foto6.jpg" data-alt="Foto 9"><img src="images/foto9.jpg" alt="Foto 9"></div>
          </div>
        </div>

        <div class="card section" id="posizione">
          <h2 data-i18n="location.title">Posizione</h2>
          <p class="muted" data-i18n="location.text">
            Milano — zona Paolo Sarpi (Chinatown). L’indirizzo completo e le istruzioni di check-in vengono condivisi dopo la conferma.
          </p>
          <p class="muted" style="margin-bottom:0;" data-i18n="location.hint">
            (In futuro puoi inserire qui un link a Google Maps o un embed.)
          </p>
        </div>

        <!-- HOST / BIO -->
        <div class="host-section section" id="host">
          <h2 data-i18n="host.title">Chi vi accoglie</h2>
          <span class="accent" aria-hidden="true"></span>
          <p class="muted" data-i18n="host.text">
            Siamo una coppia milanese di mezza età, legata a questa città e al suo modo discreto di accogliere.
            Da alcuni anni ci prendiamo cura personalmente di Casa dei Narcisi, un piccolo loft nel quartiere Chinatown,
            ristrutturato con attenzione ai dettagli e al comfort quotidiano.
            Crediamo in un’ospitalità semplice e autentica: essere presenti quando serve, lasciare spazio quando non serve,
            e far sentire ogni ospite a proprio agio, come a casa propria.
          </p>
        </div>

        <!-- CONTACT -->
        <div class="card section" id="contatti">
          <h2 data-i18n="contact.title">Contatti</h2>
          <p class="muted" data-i18n="contact.lead">Scrivici un messaggio: ti rispondiamo appena possibile.</p>

          <form class="form" id="contactForm">
            <div class="row2">
              <input type="text" name="name" id="name" placeholder="Nome" required data-i18n-placeholder="contact.name">
              <input type="email" name="email" id="email" placeholder="Email" required data-i18n-placeholder="contact.email">
            </div>

            <input type="text" name="subject" id="subject" placeholder="Oggetto (es. Richiesta info)" required data-i18n-placeholder="contact.subject">
            <textarea name="message" id="message" placeholder="Messaggio" required data-i18n-placeholder="contact.message"></textarea>

            <button class="btn primary" type="submit" style="border:0;" data-i18n="contact.send">Invia messaggio</button>
            <div class="hint" data-i18n="contact.hint">
              Non pubblichiamo l’email: il messaggio viene inviato in modo riservato.
            </div>
            <div id="contactResult" class="hint" aria-live="polite"></div>
          </form>
        </div>
      </div>

      <!-- RIGHT COLUMN: BOOKING -->
      <div class="sticky" id="prenota">
        <div class="booking-shell">
          <h3 data-i18n="booking.title">Prenota ora</h3>
          <p class="muted" data-i18n="booking.lead">Seleziona date e ospiti. I risultati si aprono in una nuova scheda.</p>

          <div id="apartmentIframe2582848"></div>

          <p class="hint" style="margin-top:10px;" data-i18n="booking.note">
            Prezzi e disponibilità aggiornati in tempo reale.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- LIGHTBOX -->
  <div class="lb" id="lightbox" aria-hidden="true">
    <div class="lb-inner" role="dialog" aria-modal="true" aria-label="Galleria foto">
      <div class="lb-top">
        <div class="title" id="lbTitle">Foto</div>
        <div class="lb-actions">
          <button class="iconbtn" id="lbPrevTop" type="button">‹</button>
          <button class="iconbtn" id="lbNextTop" type="button">›</button>
          <button class="iconbtn" id="lbClose" type="button">✕</button>
        </div>
      </div>

      <div class="lb-img" id="lbImgWrap">
        <img id="lbImg" src="" alt="">
      </div>

      <div class="lb-nav">
        <button class="iconbtn lb-prev" id="lbPrev" type="button">‹</button>
        <button class="iconbtn lb-next" id="lbNext" type="button">›</button>
      </div>
    </div>
  </div>

  <!-- STICKY FOOTER -->
  <div class="footerbar">
    <div class="inner">
      <div class="mini">
        <span>© <span id="y"></span> Casa dei Narcisi</span>
        <span>•</span>
        <a href="#contatti" style="text-decoration:none; color:var(--acc2); font-weight:750;" data-i18n="footer.contact">Contatti</a>
        <span>•</span>
        <a href="#prenota" style="text-decoration:none; color:var(--acc2); font-weight:750;" data-i18n="footer.book">Prenota</a>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn ghost" href="#contatti" data-i18n="footer.write">Scrivi</a>
        <a class="btn primary" href="#prenota" data-i18n="footer.availability">Verifica disponibilità</a>
      </div>
    </div>
  </div>

  <!-- BOOKING TOOL (Smoobu) -->
  <script type="text/javascript" src="https://login.smoobu.com/js/Settings/BookingToolIframe.js"></script>
  <script>
    BookingToolIframe.initialize({
      url: "https://login.smoobu.com/en/booking-tool/iframe/1147778/2582848?newTabAfterSearch=true",
      baseUrl: "https://login.smoobu.com",
      target: "#apartmentIframe2582848"
    });
  </script>

  <script src="https://unpkg.com/i18next@23/i18next.min.js"></script>
  <script>
    // --- i18n dictionaries (inline) ---
    // Se preferisci JSON esterni /i18n/*.json, te lo adatto subito: qui è tutto in 1 file.
    const I18N = {
      it: {
        "lang.label": "Lingua",
        "nav.services": "Servizi",
        "nav.photos": "Foto",
        "nav.location": "Posizione",
        "nav.contact": "Contatti",
        "nav.book": "Prenota",

        "hero.title": "Loft moderno a Milano",
        "hero.subtitle": "zona Paolo Sarpi",
        "hero.lead": "Un rifugio curato e funzionale in Chinatown: perfetto per soggiorni business o leisure, e comodissimo per eventi in città.",
        "hero.note": "Prenotazione diretta dal sito ufficiale.",

        "cta.availability": "Verifica disponibilità",
        "cta.contact": "Scrivici",

        "services.title": "Servizi",
        "services.lead": "Essenziale, pulito, comodo. Tutto quello che serve per vivere Milano bene.",
        "services.wifiStrong": "Wi-Fi",
        "services.wifi": "veloce",
        "services.kitchenStrong": "Cucina",
        "services.kitchen": "attrezzata",
        "services.linenStrong": "Biancheria",
        "services.linen": "e asciugamani inclusi",
        "services.selfcheckStrong": "Self check-in",
        "services.selfcheck": "(quando disponibile)",
        "services.areaStrong": "Zona servita",
        "services.area": "ristoranti, market e servizi in Paolo Sarpi",
        "services.eventsStrong": "Ideale per eventi",
        "services.events": "e soggiorni business/leisure",

        "rules.title": "Regole essenziali",
        "rules.noParties": "Niente feste / eventi",
        "rules.neighbors": "Rispetto del vicinato",
        "rules.capacity": "Orari e capienza come da prenotazione",

        "photos.title": "Foto",
        "photos.lead": "Clicca su una foto per ingrandire e navigare.",

        "location.title": "Posizione",
        "location.text": "Milano — zona Paolo Sarpi (Chinatown). L’indirizzo completo e le istruzioni di check-in vengono condivisi dopo la conferma.",
        "location.hint": "(In futuro puoi inserire qui un link a Google Maps o un embed.)",

        "host.title": "Chi vi accoglie",
        "host.text": "Siamo una coppia milanese di mezza età, legata a questa città e al suo modo discreto di accogliere.\n\nDa alcuni anni ci prendiamo cura personalmente di Casa dei Narcisi, un piccolo loft nel quartiere Chinatown, ristrutturato con attenzione ai dettagli e al comfort quotidiano.\n\nCrediamo in un’ospitalità semplice e autentica: essere presenti quando serve, lasciare spazio quando non serve, e far sentire ogni ospite a proprio agio, come a casa propria.",

        "contact.title": "Contatti",
        "contact.lead": "Scrivici un messaggio: ti rispondiamo appena possibile.",
        "contact.name": "Nome",
        "contact.email": "Email",
        "contact.subject": "Oggetto (es. Richiesta info)",
        "contact.message": "Messaggio",
        "contact.send": "Invia messaggio",
        "contact.hint": "Non pubblichiamo l’email: il messaggio viene inviato in modo riservato.",
        "contact.sending": "Invio in corso…",
        "contact.ok": "Messaggio inviato correttamente. Ti rispondiamo appena possibile.",
        "contact.err": "Non siamo riusciti a inviare il messaggio. Riprova tra poco.",

        "booking.title": "Prenota ora",
        "booking.lead": "Seleziona date e ospiti. I risultati si aprono in una nuova scheda.",
        "booking.note": "Prezzi e disponibilità aggiornati in tempo reale.",

        "footer.contact": "Contatti",
        "footer.book": "Prenota",
        "footer.write": "Scrivi",
        "footer.availability": "Verifica disponibilità"
      },

      en: {
        "lang.label": "Language",
        "nav.services": "Services",
        "nav.photos": "Photos",
        "nav.location": "Location",
        "nav.contact": "Contact",
        "nav.book": "Book",

        "hero.title": "Modern loft in Milan",
        "hero.subtitle": "Paolo Sarpi area",
        "hero.lead": "A well-kept and functional retreat in Chinatown: ideal for business or leisure stays, and convenient for city events.",
        "hero.note": "Direct booking from the official website.",

        "cta.availability": "Check availability",
        "cta.contact": "Contact us",

        "services.title": "Services",
        "services.lead": "Essential, clean, comfortable — everything you need to enjoy Milan.",
        "services.wifiStrong": "Wi-Fi",
        "services.wifi": "fast",
        "services.kitchenStrong": "Kitchen",
        "services.kitchen": "fully equipped",
        "services.linenStrong": "Linens",
        "services.linen": "and towels included",
        "services.selfcheckStrong": "Self check-in",
        "services.selfcheck": "(when available)",
        "services.areaStrong": "Great area",
        "services.area": "restaurants, shops and services along Paolo Sarpi",
        "services.eventsStrong": "Great for events",
        "services.events": "and business/leisure stays",

        "rules.title": "House rules",
        "rules.noParties": "No parties / events",
        "rules.neighbors": "Respect the neighbors",
        "rules.capacity": "Times and occupancy as booked",

        "photos.title": "Photos",
        "photos.lead": "Click a photo to enlarge and navigate.",

        "location.title": "Location",
        "location.text": "Milan — Paolo Sarpi (Chinatown). Full address and check-in instructions are shared after confirmation.",
        "location.hint": "(You can add a Google Maps link or embed later.)",

        "host.title": "Your hosts",
        "host.text": "We are a middle-aged Milanese couple, deeply connected to this city and its discreet way of welcoming guests.\n\nFor several years we have personally taken care of Casa dei Narcisi, a small loft in the Chinatown district, renovated with great attention to everyday comfort.\n\nWe believe in simple and genuine hospitality: being there when needed, stepping back when not, and making every guest feel at home.",

        "contact.title": "Contact",
        "contact.lead": "Send us a message — we’ll get back to you as soon as possible.",
        "contact.name": "Name",
        "contact.email": "Email",
        "contact.subject": "Subject (e.g. Availability)",
        "contact.message": "Message",
        "contact.send": "Send message",
        "contact.hint": "We don’t publish our email — messages are sent privately.",
        "contact.sending": "Sending…",
        "contact.ok": "Message sent. We’ll get back to you soon.",
        "contact.err": "We couldn’t send your message. Please try again later.",

        "booking.title": "Book now",
        "booking.lead": "Choose dates and guests. Results open in a new tab.",
        "booking.note": "Real-time prices and availability.",

        "footer.contact": "Contact",
        "footer.book": "Book",
        "footer.write": "Write",
        "footer.availability": "Check availability"
      }
    };

    // Year
    document.getElementById("y").textContent = new Date().getFullYear();

    // --- i18n init ---
    const allowed = ["it","en","fr","de","es"];

    function getLang() {
      const saved = localStorage.getItem("lang");
      if (saved && allowed.includes(saved)) return saved;
      const nav = (navigator.language || "it").slice(0,2).toLowerCase();
      return allowed.includes(nav) ? nav : "it";
    }

    async function initI18n(lng) {
      // Fallback: if we don't have dict for the language yet, fall back to EN/IT
      const resources = {
        it: { translation: I18N.it },
        en: { translation: I18N.en }
      };

      // quick fallback for fr/de/es -> en (for now)
      if (!resources[lng]) resources[lng] = resources.en;

      i18next.init({ lng, fallbackLng: "it", resources }, () => {
        document.documentElement.lang = lng;

        // text nodes
        document.querySelectorAll("[data-i18n]").forEach(el => {
          el.innerHTML = i18next.t(el.dataset.i18n).replace(/\n/g, "<br>");
        });

        // placeholders
        document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
          el.setAttribute("placeholder", i18next.t(el.dataset.i18nPlaceholder));
        });
      });
    }

    const langSelect = document.getElementById("langSelect");
    const initialLang = getLang();
    langSelect.value = initialLang;
    initI18n(initialLang);

    langSelect.addEventListener("change", () => {
      const lng = langSelect.value;
      localStorage.setItem("lang", lng);
      initI18n(lng);
    });

    // --- Contact form -> POST /api/contact ---
    document.getElementById("contactForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const result = document.getElementById("contactResult");
      result.className = "hint";
      result.textContent = i18next.t("contact.sending");

      const payload = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        subject: document.getElementById("subject").value.trim(),
        message: document.getElementById("message").value.trim(),
        page: location.href,
        lang: i18next.language
      };

      try {
        const res = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error("Bad response");

        result.className = "hint ok";
        result.textContent = i18next.t("contact.ok");
        e.target.reset();
      } catch (err) {
        result.className = "hint err";
        result.textContent = i18next.t("contact.err");
      }
    });

    // --- Lightbox gallery ---
    const thumbs = Array.from(document.querySelectorAll("#gallery .thumb"));
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");
    const lbTitle = document.getElementById("lbTitle");
    let idx = 0;

    function openLb(i){
      idx = i;
      const full = thumbs[idx].getAttribute("data-full");
      const alt  = thumbs[idx].getAttribute("data-alt") || `Photo ${idx+1}`;
      lbImg.src = full;
      lbImg.alt = alt;
      lbTitle.textContent = `${alt} (${idx+1}/${thumbs.length})`;
      lb.classList.add("open");
      lb.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeLb(){
      lb.classList.remove("open");
      lb.setAttribute("aria-hidden","true");
      lbImg.src = "";
      document.body.style.overflow = "";
    }
    function prev(){ idx = (idx - 1 + thumbs.length) % thumbs.length; openLb(idx); }
    function next(){ idx = (idx + 1) % thumbs.length; openLb(idx); }

    thumbs.forEach((t, i) => {
      t.addEventListener("click", () => openLb(i));
      t.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " ") { e.preventDefault(); openLb(i); }
      });
    });

    document.getElementById("lbClose").addEventListener("click", closeLb);
    document.getElementById("lbPrev").addEventListener("click", prev);
    document.getElementById("lbNext").addEventListener("click", next);
    document.getElementById("lbPrevTop").addEventListener("click", prev);
    document.getElementById("lbNextTop").addEventListener("click", next);

    lb.addEventListener("click", (e) => { if(e.target === lb) closeLb(); });

    document.addEventListener("keydown", (e) => {
      if(!lb.classList.contains("open")) return;
      if(e.key === "Escape") closeLb();
      if(e.key === "ArrowLeft") prev();
      if(e.key === "ArrowRight") next();
    });

    let touchX = null;
    const imgWrap = document.getElementById("lbImgWrap");
    imgWrap.addEventListener("touchstart", (e) => { touchX = e.touches[0].clientX; }, {passive:true});
    imgWrap.addEventListener("touchend", (e) => {
      if(touchX === null) return;
      const dx = e.changedTouches[0].clientX - touchX;
      touchX = null;
      if(Math.abs(dx) < 40) return;
      if(dx > 0) prev(); else next();
    }, {passive:true});
  </script>
</body>
</html>
